<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#2b003b">
<title>Dashboard - Oasis of Truth</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@600;700;800&display=swap" rel="stylesheet">

<style>
:root {
  --violet-500: #2b003b;
  --violet-600: #3e1a57;
  --violet-700: #2a0032;
  --violet-100: #f3e8ff;
  --violet-50: #faf5ff;
  --gray-900: #111827;
  --gray-700: #374151;
  --gray-600: #4b5563;
  --gray-500: #6b7280;
  --gray-300: #d1d5db;
  --gray-100: #f3f4f6;
  --green-500: #10b981;
  --green-100: #d1fae5;
  --amber-500: #f59e0b;
  --amber-100: #fef3c7;
}

/* ================= GLOBAL ================= */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(180deg, var(--violet-50), #fff);
  color: var(--gray-900);
  min-height: 100vh;
}

/* ================= HEADER ================= */
.app-header {
  position: sticky;
  top: 0;
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(15px);
  border-bottom: 1px solid rgba(43, 0, 59, 0.10);
}

.header-title {
  font-family: 'Playfair Display', serif;
  font-size: 1.15rem;
  font-weight: 700;
  color: var(--violet-600);
}

.hamburger,
.profile-btn {
  background: none;
  border: none;
  cursor: pointer;
  font-size: 1.5rem;
  color: var(--violet-600);
  padding: 4px;
}

.profile-icon {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--violet-100);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  color: var(--violet-600);
}

/* ================= NAVIGATION ================= */
.slide-nav {
  position: fixed;
  top: 0;
  left: -100%;
  width: 260px;
  height: 100%;
  background: white;
  padding: 80px 20px 20px;
  transition: 0.3s ease;
  box-shadow: 4px 0 24px rgba(0, 0, 0, 0.08);
  z-index: 999;
}

.slide-nav.active {
  left: 0;
}

.slide-nav ul {
  list-style: none;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.slide-nav a {
  text-decoration: none;
  font-weight: 600;
  color: var(--gray-700);
  font-size: 0.95rem;
  padding: 12px 16px;
  display: block;
  border-radius: 8px;
  transition: 0.2s;
}

.slide-nav a:hover {
  background: var(--violet-50);
  color: var(--violet-600);
}

/* Profile menu */
.profile-menu {
  position: absolute;
  top: 56px;
  right: 16px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
  padding: 8px 0;
  display: none;
  min-width: 160px;
  z-index: 1001;
}

.profile-menu.active {
  display: block;
}

.profile-menu a {
  display: block;
  padding: 10px 16px;
  text-decoration: none;
  font-weight: 600;
  color: var(--gray-700);
  font-size: 0.9rem;
  transition: 0.2s;
}

.profile-menu a:hover {
  background: var(--violet-50);
  color: var(--violet-600);
}

/* ================= CONTENT ================= */
main {
  padding: 20px 16px;
  max-width: 800px;
  margin: 0 auto;
}

.welcome {
  text-align: center;
  margin-bottom: 24px;
}

.welcome-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: var(--violet-100);
  color: var(--violet-600);
  padding: 6px 16px;
  border-radius: 999px;
  font-weight: 700;
  margin-bottom: 12px;
  font-size: 0.9rem;
}

.welcome h1 {
  font-family: 'Playfair Display', serif;
  font-size: 1.5rem;
  margin-bottom: 8px;
  color: var(--gray-900);
}

.welcome p {
  font-size: 1rem;
  color: var(--gray-600);
}

/* Stats Bar */
.stats-bar {
  background: white;
  border-radius: 16px;
  padding: 20px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  box-shadow: 0 2px 16px rgba(43, 0, 59, 0.08);
  margin-bottom: 24px;
}

.stat-item {
  text-align: center;
}

.stat-value {
  font-size: 2rem;
  font-weight: 800;
  color: var(--violet-600);
  display: block;
  line-height: 1;
  margin-bottom: 4px;
}

.stat-label {
  font-size: 0.85rem;
  color: var(--gray-600);
  font-weight: 500;
}

/* Concept Explanation */
.concept-card {
  background: linear-gradient(135deg, var(--violet-600), var(--violet-500));
  color: white;
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 24px;
  box-shadow: 0 4px 20px rgba(124, 58, 237, 0.25);
}

.concept-card h3 {
  font-size: 1.1rem;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.concept-card p {
  font-size: 0.95rem;
  line-height: 1.6;
  opacity: 0.95;
}

.concept-card ul {
  margin-top: 12px;
  padding-left: 20px;
  font-size: 0.9rem;
  line-height: 1.7;
  opacity: 0.95;
}

/* Habits Section */
.habits-section {
  margin-bottom: 24px;
}

.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
}

.section-header h2 {
  font-size: 1.2rem;
  color: var(--gray-900);
  font-weight: 700;
}

.habits-count {
  font-size: 0.85rem;
  color: var(--gray-500);
  font-weight: 600;
}

/* Habit Card */
.habit-card {
  background: white;
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 12px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
  border: 2px solid transparent;
  transition: all 0.3s;
  cursor: pointer;
}

.habit-card:hover:not(.locked) {
  transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(43, 0, 59, 0.15);
}

.habit-card.selected {
  border-color: var(--violet-500);
  background: linear-gradient(135deg, rgba(43, 0, 59, 0.05), rgba(62, 26, 87, 0.08));
}

.habit-card.locked {
  opacity: 0.5;
  cursor: not-allowed;
  background: var(--gray-100);
}

.habit-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
}

.habit-title {
  font-size: 1.05rem;
  font-weight: 700;
  color: var(--gray-900);
  display: flex;
  align-items: center;
  gap: 8px;
}

.habit-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  background: var(--green-100);
  color: var(--green-500);
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 700;
}

.habit-card.locked .habit-badge {
  background: var(--gray-300);
  color: var(--gray-500);
}

.habit-stats {
  display: flex;
  gap: 20px;
  font-size: 0.85rem;
  color: var(--gray-600);
}

.habit-stat {
  display: flex;
  align-items: center;
  gap: 4px;
}

.habit-stat strong {
  color: var(--violet-600);
  font-weight: 700;
}

.lock-message {
  background: var(--amber-100);
  color: var(--amber-500);
  padding: 8px 12px;
  border-radius: 8px;
  font-size: 0.85rem;
  margin-top: 12px;
  font-weight: 600;
  text-align: center;
}

/* Add Habit */
.add-habit-card {
  background: white;
  border: 2px dashed var(--gray-300);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 12px;
  transition: 0.3s;
}

.add-habit-card.disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.add-habit-controls {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
}

.add-habit-controls input {
  flex: 1;
  padding: 12px 16px;
  border-radius: 12px;
  border: 2px solid var(--gray-300);
  font-size: 0.95rem;
  transition: 0.2s;
}

.add-habit-controls input:focus {
  outline: none;
  border-color: var(--violet-500);
}

.add-habit-controls button {
  padding: 12px 20px;
  border-radius: 12px;
  border: none;
  background: var(--violet-600);
  color: white;
  font-weight: 700;
  cursor: pointer;
  transition: 0.2s;
  font-size: 0.95rem;
}

.add-habit-controls button:hover:not(:disabled) {
  background: var(--violet-700);
}

.add-habit-controls button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Suggestions */
.suggestions-section {
  margin-top: 16px;
}

.suggestions-section h4 {
  font-size: 0.9rem;
  color: var(--gray-600);
  margin-bottom: 8px;
  font-weight: 600;
}

.suggestions-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  list-style: none;
}

.suggestion-chip {
  background: var(--violet-50);
  color: var(--violet-600);
  padding: 8px 14px;
  border-radius: 999px;
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  transition: 0.2s;
  border: 1px solid var(--violet-100);
}

.suggestion-chip:hover {
  background: var(--violet-100);
  transform: scale(1.05);
}

/* Start Button */
.start-section {
  margin-bottom: 24px;
}

.btn-start {
  width: 100%;
  padding: 16px;
  background: linear-gradient(135deg, var(--violet-600), var(--violet-500));
  border: none;
  color: white;
  font-size: 1.1rem;
  font-weight: 700;
  border-radius: 14px;
  cursor: pointer;
  transition: 0.3s;
  box-shadow: 0 4px 16px rgba(43, 0, 59, 0.3);
}

.btn-start:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 6px 24px rgba(43, 0, 59, 0.4);
}

.btn-start:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Modal */
.modal {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.6);
  padding: 16px;
  z-index: 1002;
  backdrop-filter: blur(4px);
}

.modal.active {
  display: flex;
}

.modal-content {
  background: white;
  padding: 32px;
  border-radius: 24px;
  text-align: center;
  max-width: 400px;
  width: 100%;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

.modal-content h3 {
  font-size: 1.3rem;
  margin-bottom: 8px;
  color: var(--gray-900);
}

.modal-habit-name {
  font-size: 0.95rem;
  color: var(--violet-600);
  font-weight: 600;
  margin-bottom: 20px;
}

.timer {
  font-size: 3.5rem;
  font-weight: 800;
  color: var(--violet-600);
  margin: 20px 0;
  font-family: 'Playfair Display', serif;
}

.timer-progress {
  width: 100%;
  height: 8px;
  background: var(--gray-200);
  border-radius: 999px;
  margin: 20px 0;
  overflow: hidden;
}

.timer-progress-bar {
  height: 100%;
  background: linear-gradient(90deg, var(--violet-600), var(--violet-500));
  border-radius: 999px;
  transition: width 1s linear;
}

.modal-actions {
  display: flex;
  gap: 12px;
  margin-top: 20px;
}

.btn-secondary {
  flex: 1;
  padding: 14px;
  background: var(--gray-200);
  border: none;
  color: var(--gray-700);
  font-size: 1rem;
  font-weight: 700;
  border-radius: 12px;
  cursor: pointer;
  transition: 0.2s;
}

.btn-secondary:hover {
  background: var(--gray-300);
}

.btn-done {
  flex: 1;
  padding: 14px;
  background: var(--green-500);
  border: none;
  color: white;
  font-size: 1rem;
  font-weight: 700;
  border-radius: 12px;
  cursor: pointer;
  transition: 0.2s;
}

.btn-done:hover {
  opacity: 0.9;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 40px 20px;
  color: var(--gray-500);
}

.empty-state-icon {
  font-size: 3rem;
  margin-bottom: 12px;
  opacity: 0.5;
}

.empty-state p {
  font-size: 0.95rem;
  line-height: 1.6;
}

/* ================= PROGRESS CHART ================= */
.progress-section {
  margin-bottom: 24px;
}

.progress-chart-card {
  background: white;
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
}

.chart-container {
  display: flex;
  align-items: flex-end;
  justify-content: space-around;
  gap: 8px;
  height: 180px;
  padding: 20px 0;
}

.chart-bar {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.bar {
  width: 100%;
  max-width: 50px;
  background: linear-gradient(180deg, var(--violet-500), var(--violet-600));
  border-radius: 8px 8px 0 0;
  transition: all 0.3s;
  position: relative;
}

.bar.completed {
  background: linear-gradient(180deg, var(--green-500), #059669);
}

.bar.empty {
  background: var(--gray-200);
  opacity: 0.5;
}

.bar:hover {
  opacity: 0.8;
  transform: scale(1.05);
}

.bar-label {
  font-size: 0.75rem;
  color: var(--gray-600);
  font-weight: 600;
}

.bar-value {
  position: absolute;
  top: -24px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.75rem;
  font-weight: 700;
  color: var(--violet-600);
  display: none;
}

.bar.completed .bar-value {
  display: block;
  color: var(--green-500);
}

/* ================= ACTIVITY SECTION ================= */
.activity-section {
  margin-bottom: 24px;
}

.activity-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.activity-item {
  background: white;
  border-radius: 12px;
  padding: 16px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  display: flex;
  align-items: center;
  gap: 16px;
  transition: 0.2s;
}

.activity-item:hover {
  transform: translateX(4px);
  box-shadow: 0 4px 12px rgba(43, 0, 59, 0.1);
}

.activity-icon {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--violet-100);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  flex-shrink: 0;
}

.activity-content {
  flex: 1;
}

.activity-title {
  font-weight: 600;
  color: var(--gray-900);
  font-size: 0.95rem;
  margin-bottom: 2px;
}

.activity-time {
  font-size: 0.8rem;
  color: var(--gray-500);
}

.activity-empty {
  text-align: center;
  padding: 40px 20px;
  color: var(--gray-500);
  background: white;
  border-radius: 12px;
}

/* ================= QUOTE SECTION ================= */
.quote-section {
  margin-bottom: 24px;
}

.quote-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 16px;
  padding: 32px 24px;
  text-align: center;
  color: white;
  box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
  position: relative;
  overflow: hidden;
}

.quote-card::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
  pointer-events: none;
}

.quote-icon {
  font-size: 2.5rem;
  margin-bottom: 16px;
  opacity: 0.9;
}

.quote-text {
  font-size: 1.1rem;
  line-height: 1.7;
  font-style: italic;
  margin-bottom: 12px;
  position: relative;
  z-index: 1;
}

.quote-author {
  font-size: 0.9rem;
  opacity: 0.9;
  font-weight: 600;
  position: relative;
  z-index: 1;
}

/* ================= ACHIEVEMENTS ================= */
.achievements-section {
  margin-bottom: 32px;
}

.achievements-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 12px;
}

.achievement-card {
  background: white;
  border-radius: 12px;
  padding: 20px 16px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  transition: 0.3s;
  border: 2px solid transparent;
}

.achievement-card.unlocked {
  border-color: var(--violet-500);
  background: linear-gradient(135deg, rgba(43, 0, 59, 0.05), rgba(62, 26, 87, 0.08));
}

.achievement-card.locked {
  opacity: 0.5;
  filter: grayscale(1);
}

.achievement-card:hover.unlocked {
  transform: translateY(-4px);
  box-shadow: 0 8px 20px rgba(43, 0, 59, 0.2);
}

.achievement-icon {
  font-size: 2.5rem;
  margin-bottom: 8px;
}

.achievement-title {
  font-size: 0.85rem;
  font-weight: 700;
  color: var(--gray-900);
  margin-bottom: 4px;
}

.achievement-desc {
  font-size: 0.75rem;
  color: var(--gray-600);
  line-height: 1.4;
}

/* ================= RESPONSIVE ================= */
@media (min-width: 600px) {
  .header-title {
    font-size: 1.3rem;
  }

  main {
    padding: 32px 24px;
  }

  .welcome h1 {
    font-size: 2rem;
  }

  .stats-bar {
    padding: 24px;
    gap: 24px;
  }

  .stat-value {
    font-size: 2.5rem;
  }

  .concept-card {
    padding: 24px;
  }

  .habit-card {
    padding: 24px;
  }

  .modal-content {
    padding: 40px;
  }

  .timer {
    font-size: 4rem;
  }

  .chart-container {
    height: 200px;
    gap: 12px;
  }

  .achievements-grid {
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 16px;
  }

  .quote-card {
    padding: 40px 32px;
  }

  .quote-text {
    font-size: 1.2rem;
  }
}

@media (min-width: 900px) {
  .stats-bar {
    padding: 28px;
  }

  .achievements-grid {
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  }
}
</style>
</head>
<body>

<header class="app-header">
  <button class="hamburger" id="hamburgerBtn" aria-label="Menu">‚ò∞</button>
  <div class="header-title">Oasis of Truth</div>
  <a class="profile-btn" id="profileBtn" href="../profile.html" aria-label="My profile">
    <div class="profile-icon" id="profileIcon">U</div>
  </a>

  <nav class="slide-nav" id="slideNav">
    <ul>
      <li><a href="../dashboard.html">üìä Dashboard</a></li>
      <li><a href="../profile.html">üë§ My profile</a></li>
      <li><a href="../commitmentpage.html">üéØ My commitments</a></li>
      <li><a href="../statistics.html">üìà Statistics</a></li>
      <li><a href="../parametes.html">‚öôÔ∏è Settings</a></li>
    </ul>
  </nav>

  <div class="profile-menu" id="profileMenu">
    <a href="../profile.html">View profile</a>
    <a href="../parametes.html">Settings</a>
    <a href="#" onclick="localStorage.clear();location.reload();return false;">Log out</a>
  </div>
</header>
 
<script src="/assets/js/profile-icon.js"></script>
<main>
  <section class="welcome">
    <div class="welcome-badge">
      <span>üéâ</span>
      <span id="dayBadge">Day 1</span>
    </div>
    <h1>Welcome to your Oasis</h1>
    <p>Build your habits, 15 minutes at a time</p>
  </section>

  <div class="stats-bar">
    <div class="stat-item">
      <span class="stat-value" id="streakCount">0</span>
      <span class="stat-label">Streak (days)</span>
    </div>
    <div class="stat-item">
      <span class="stat-value" id="completedCount">0</span>
      <span class="stat-label">Total sessions</span>
    </div>
    <div class="stat-item">
      <span class="stat-value" id="minutesCount">0</span>
      <span class="stat-label">Minutes invested</span>
    </div>
  </div>

  <div class="concept-card">
    <h3>üí° How it works</h3>
    <p>
      Each day, spend <strong>15 minutes</strong> on a positive habit.
      One habit at a time to stay focused!
    </p>
    <ul>
      <li>üìÖ <strong>Practice 15 consecutive days</strong> to unlock a 2nd habit</li>
      <li>üî• Keep your streak to accumulate multiple habits</li>
      <li>‚è±Ô∏è Only 15 minutes a day ‚Äî every day counts</li>
    </ul>
  </div>

  <section class="habits-section">
    <div class="section-header">
      <h2>My Habits</h2>
      <span class="habits-count"><span id="habitsCountText">0</span> habit(s)</span>
    </div>

    <div id="habitsContainer"></div>

    <div class="add-habit-card" id="addHabitCard">
      <div class="add-habit-controls">
        <input 
          id="newHabitInput" 
          placeholder="New habit (e.g., Morning meditation)"
          aria-label="New habit"
          maxlength="60"
        >
        <button id="addHabitBtn">‚ûï Add</button>
      </div>

      <div class="suggestions-section">
        <h4>üí≠ Suggestions</h4>
        <ul class="suggestions-list" id="suggestionsList"></ul>
      </div>
    </div>
  </section>

  <div class="start-section">
    <button id="startSessionBtn" class="btn-start" disabled>
      ‚è±Ô∏è Start my 15-minute session
    </button>
  </div>

  <!-- Progress Chart Section -->
  <section class="progress-section">
    <div class="section-header">
      <h2>7-Day Progress</h2>
    </div>
    <div class="progress-chart-card">
      <div class="chart-container" id="progressChart"></div>
    </div>
  </section>

  <!-- Recent Activity Section -->
  <section class="activity-section">
    <div class="section-header">
      <h2>Recent activity</h2>
    </div>
    <div class="activity-list" id="activityList"></div>
  </section>

  <!-- Motivational Quote Section -->
  <section class="quote-section">
    <div class="quote-card">
      <div class="quote-icon">üí¨</div>
      <p class="quote-text" id="quoteText"></p>
      <p class="quote-author" id="quoteAuthor"></p>
    </div>
  </section>

  <!-- Achievements Section -->
  <section class="achievements-section">
    <div class="section-header">
      <h2>üèÜ Unlocked Achievements</h2>
    </div>
    <div class="achievements-grid" id="achievementsGrid"></div>
  </section>
</main>

<div class="modal" id="timerModal">
  <div class="modal-content">
    <h3>Session in progress</h3>
    <div class="modal-habit-name" id="modalHabitName"></div>
    
    <div class="timer" id="timer">15:00</div>
    
    <div class="timer-progress">
      <div class="timer-progress-bar" id="timerProgressBar"></div>
    </div>

    <div class="modal-actions">
      <button class="btn-secondary" id="cancelBtn">Cancel</button>
      <button class="btn-done" id="doneBtn">‚úì Finish</button>
    </div>
  </div>
</div>

<script>
// ============= NAVIGATION =============
const hamburger = document.getElementById('hamburgerBtn');
const slideNav = document.getElementById('slideNav');
const profileBtn = document.getElementById('profileBtn');
const profileMenu = document.getElementById('profileMenu');

hamburger.onclick = () => slideNav.classList.toggle('active');
profileBtn.onclick = () => profileMenu.classList.toggle('active');

document.addEventListener('click', e => {
  if (!slideNav.contains(e.target) && !hamburger.contains(e.target)) {
    slideNav.classList.remove('active');
  }
  if (!profileMenu.contains(e.target) && !profileBtn.contains(e.target)) {
    profileMenu.classList.remove('active');
  }
});

// ============= HABITS MANAGEMENT =============
(function() {
  const HABITS_KEY = 'habits';
  const SELECTED_KEY = 'selectedHabitIndex';
  const STREAK_KEY = 'streak';
  const COMPLETED_KEY = 'completed';
  const MINUTES_KEY = 'totalMinutes';
  const LAST_COMPLETED_KEY = 'lastCompletedDate';

  let habits = [];
  let selectedIndex = -1;
  let streak = 0;
  let completed = 0;
  let totalMinutes = 0;

  const habitsContainer = document.getElementById('habitsContainer');
  const newHabitInput = document.getElementById('newHabitInput');
  const addHabitBtn = document.getElementById('addHabitBtn');
  const addHabitCard = document.getElementById('addHabitCard');
  const startBtn = document.getElementById('startSessionBtn');
  const suggestionsList = document.getElementById('suggestionsList');

  const suggestions = [
    'Morning meditation',
    'Daily reading',
    'Journaling / Gratitude',
    'Stretching & mobility',
    'Language learning',
    'Drawing / Creativity',
    'Writing',
    'Physical exercise',
    'Daily planning'
  ];

  // ============= LOAD & SAVE =============
  function loadData() {
    try {
      habits = JSON.parse(localStorage.getItem(HABITS_KEY) || '[]');
      selectedIndex = parseInt(localStorage.getItem(SELECTED_KEY) || '-1', 10);
      streak = parseInt(localStorage.getItem(STREAK_KEY) || '0', 10);
      completed = parseInt(localStorage.getItem(COMPLETED_KEY) || '0', 10);
      totalMinutes = parseInt(localStorage.getItem(MINUTES_KEY) || '0', 10);
    } catch (e) {
      console.error('Error loading data:', e);
      habits = [];
      selectedIndex = -1;
      streak = 0;
      completed = 0;
      totalMinutes = 0;
    }
  }

  function saveData() {
    localStorage.setItem(HABITS_KEY, JSON.stringify(habits));
    localStorage.setItem(SELECTED_KEY, String(selectedIndex));
    localStorage.setItem(STREAK_KEY, String(streak));
    localStorage.setItem(COMPLETED_KEY, String(completed));
    localStorage.setItem(MINUTES_KEY, String(totalMinutes));
  }

  // ============= RENDER UI =============
  function render() {
    renderHabits();
    renderStats();
    renderSuggestions();
    updateAddHabitState();
    updateStartButtonState();
  }

  function renderHabits() {
    habitsContainer.innerHTML = '';

    if (habits.length === 0) {
      habitsContainer.innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon"><i class="fi fi-tr-aloe-vera"></i></div>
          <p><strong>Start your journey!</strong><br>
          Add your first habit below.</p>
        </div>
      `;
      return;
    }

    habits.forEach((habit, index) => {
      const isLocked = index > 0 && streak < 15;
      const isSelected = index === selectedIndex;

      const card = document.createElement('div');
      card.className = `habit-card ${isSelected ? 'selected' : ''} ${isLocked ? 'locked' : ''}`;

      let badgeHTML = '';
      if (isLocked) {
        badgeHTML = `<span class="habit-badge">üîí Verrouill√©e</span>`;
      } else if (isSelected) {
        badgeHTML = `<span class="habit-badge">‚úì S√©lectionn√©e</span>`;
      }

      let lockMessageHTML = '';
      if (isLocked) {
        const daysNeeded = 15 - streak;
        lockMessageHTML = `
          <div class="lock-message">
            üîê ${daysNeeded} day${daysNeeded > 1 ? 's' : ''} of streak left to unlock
          </div>
        `;
      }

      card.innerHTML = `
        <div class="habit-header">
          <div class="habit-title">
            ${isLocked ? 'üîí' : '‚ú®'} ${habit.name}
          </div>
          ${badgeHTML}
        </div>
        <div class="habit-stats">
          <div class="habit-stat">
            <span>üî•</span>
            <span><strong>${habit.streak || 0}</strong> days</span>
          </div>
          <div class="habit-stat">
            <span>‚úì</span>
            <span><strong>${habit.completedCount || 0}</strong> sessions</span>
          </div>
        </div>
        ${lockMessageHTML}
      `;

      if (!isLocked) {
        card.onclick = () => selectHabit(index);
      }

      habitsContainer.appendChild(card);
    });

    document.getElementById('habitsCountText').textContent = habits.length;
  }

  function renderStats() {
    document.getElementById('streakCount').textContent = streak;
    document.getElementById('completedCount').textContent = completed;
    document.getElementById('minutesCount').textContent = totalMinutes;
    document.getElementById('dayBadge').textContent = streak > 0 ? `Day ${streak}` : 'Day 1';
  }

  function renderSuggestions() {
    suggestionsList.innerHTML = '';
    
    suggestions.forEach(suggestion => {
      const alreadyExists = habits.some(h => 
        h.name.toLowerCase() === suggestion.toLowerCase()
      );

      if (!alreadyExists) {
        const chip = document.createElement('li');
        chip.className = 'suggestion-chip';
        chip.textContent = suggestion;
        chip.onclick = () => addHabit(suggestion);
        suggestionsList.appendChild(chip);
      }
    });
  }

  function updateAddHabitState() {
    const canAddHabit = habits.length === 0 || streak >= 15;
    
    if (!canAddHabit) {
      addHabitCard.classList.add('disabled');
      newHabitInput.disabled = true;
      addHabitBtn.disabled = true;
    } else {
      addHabitCard.classList.remove('disabled');
      newHabitInput.disabled = false;
      addHabitBtn.disabled = false;
    }
  }

  function updateStartButtonState() {
    const canStart = selectedIndex >= 0 && selectedIndex < habits.length;
    startBtn.disabled = !canStart;
    
    if (canStart) {
      startBtn.textContent = `‚è±Ô∏è Start "${habits[selectedIndex].name}"`;
    } else {
      startBtn.textContent = '‚è±Ô∏è Start my 15-minute session';
    }
  }

  // ============= ACTIONS =============
  function selectHabit(index) {
    const isLocked = index > 0 && streak < 15;
    if (isLocked) return;

    selectedIndex = index;
    saveData();
    render();
  }

  function addHabit(name) {
    if (!name || name.trim() === '') return;
    
    const canAddHabit = habits.length === 0 || streak >= 15;
    if (!canAddHabit) {
      alert('Reach a 15-day streak to unlock a new habit! üí™');
      return;
    }

    const alreadyExists = habits.some(h => 
      h.name.toLowerCase() === name.trim().toLowerCase()
    );

    if (alreadyExists) {
      alert('This habit already exists! üòä');
      return;
    }

    habits.push({
      name: name.trim(),
      streak: 0,
      completedCount: 0,
      createdAt: new Date().toISOString()
    });

    // Auto-select if it's the first habit
    if (habits.length === 1) {
      selectedIndex = 0;
    }

    saveData();
    render();
    newHabitInput.value = '';
    newHabitInput.focus();
  }

  addHabitBtn.onclick = () => addHabit(newHabitInput.value);
  newHabitInput.onkeydown = (e) => {
    if (e.key === 'Enter') {
      addHabitBtn.click();
    }
  };

  // ============= TIMER =============
  let timerInterval = null;
  let remainingSeconds = 0;
  const TOTAL_SECONDS = 15 * 60;

  const modal = document.getElementById('timerModal');
  const timerDisplay = document.getElementById('timer');
  const modalHabitName = document.getElementById('modalHabitName');
  const progressBar = document.getElementById('timerProgressBar');
  const cancelBtn = document.getElementById('cancelBtn');
  const doneBtn = document.getElementById('doneBtn');

  function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
  }

  function startTimer() {
    if (selectedIndex < 0 || !habits[selectedIndex]) {
      alert('Please select a habit first! üòä');
      return;
    }

    remainingSeconds = TOTAL_SECONDS;
    modal.classList.add('active');
    modalHabitName.textContent = habits[selectedIndex].name;
    timerDisplay.textContent = formatTime(remainingSeconds);
    progressBar.style.width = '100%';

    timerInterval = setInterval(() => {
      remainingSeconds--;
      timerDisplay.textContent = formatTime(remainingSeconds);
      
      const progress = (remainingSeconds / TOTAL_SECONDS) * 100;
      progressBar.style.width = `${progress}%`;

      if (remainingSeconds <= 0) {
        completeSession();
      }
    }, 1000);
  }

  function stopTimer() {
    if (timerInterval) {
      clearInterval(timerInterval);
      timerInterval = null;
    }
    modal.classList.remove('active');
  }

  function completeSession() {
    stopTimer();

    // Update stats
    completed++;
    totalMinutes += 15;

    // Update habit stats
    if (selectedIndex >= 0 && habits[selectedIndex]) {
      habits[selectedIndex].completedCount = (habits[selectedIndex].completedCount || 0) + 1;
    }

    // Update streak logic
    const today = new Date();
    const todayDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
    const lastCompletedStr = localStorage.getItem(LAST_COMPLETED_KEY);

    if (lastCompletedStr) {
      const lastDate = new Date(lastCompletedStr);
      const lastCompletedDate = new Date(lastDate.getFullYear(), lastDate.getMonth(), lastDate.getDate());
      const yesterday = new Date(todayDate);
      yesterday.setDate(yesterday.getDate() - 1);

      if (+lastCompletedDate === +todayDate) {
        // Same day - don't increment streak
      } else if (+lastCompletedDate === +yesterday) {
        // Consecutive day - increment streak
        streak++;
        if (selectedIndex >= 0 && habits[selectedIndex]) {
          habits[selectedIndex].streak = (habits[selectedIndex].streak || 0) + 1;
        }
      } else {
        // Streak broken - reset to 1
        streak = 1;
        if (selectedIndex >= 0 && habits[selectedIndex]) {
          habits[selectedIndex].streak = 1;
        }
      }
    } else {
      // First completion ever
      streak = 1;
      if (selectedIndex >= 0 && habits[selectedIndex]) {
        habits[selectedIndex].streak = 1;
      }
    }

    localStorage.setItem(LAST_COMPLETED_KEY, todayDate.toISOString());
    saveData();
    render();

    // Celebration message
    if (streak === 15) {
      setTimeout(() => {
        alert('üéâ Congratulations! You reached 15 days in a row! You can now add a new habit! üåü');
      }, 300);
    } else {
      setTimeout(() => {
        alert(`‚ú® Well done! Session completed.\nYour streak: ${streak} day${streak > 1 ? 's' : ''} üî•`);
      }, 300);
    }
  }

  startBtn.onclick = startTimer;
  cancelBtn.onclick = stopTimer;
  doneBtn.onclick = completeSession;

  // ============= INIT =============
  loadData();
  render();

  // Set profile icon
  try {
    const userName = localStorage.getItem('userName') || 'User';
    document.getElementById('profileIcon').textContent = userName.charAt(0).toUpperCase();
  } catch (e) {
    document.getElementById('profileIcon').textContent = 'U';
  }

  // ============= PROGRESS CHART =============
  function renderProgressChart() {
    const chartContainer = document.getElementById('progressChart');
    chartContainer.innerHTML = '';

    const today = new Date();
    const last7Days = [];

    for (let i = 6; i >= 0; i--) {
      const date = new Date(today);
      date.setDate(date.getDate() - i);
      last7Days.push(date);
    }

    const activityLog = JSON.parse(localStorage.getItem('activityLog') || '[]');

    last7Days.forEach(date => {
      const dateStr = date.toISOString().split('T')[0];
      const hasActivity = activityLog.some(log => {
        const logDate = new Date(log.date).toISOString().split('T')[0];
        return logDate === dateStr;
      });

      const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
      const isToday = dateStr === today.toISOString().split('T')[0];

      const barContainer = document.createElement('div');
      barContainer.className = 'chart-bar';

      const bar = document.createElement('div');
      bar.className = `bar ${hasActivity ? 'completed' : 'empty'}`;
      bar.style.height = hasActivity ? '100%' : '20%';

      if (hasActivity) {
        const value = document.createElement('div');
        value.className = 'bar-value';
        value.textContent = '15';
        bar.appendChild(value);
      }

      const label = document.createElement('div');
      label.className = 'bar-label';
      label.textContent = isToday ? 'Today' : dayName;

      barContainer.appendChild(bar);
      barContainer.appendChild(label);
      chartContainer.appendChild(barContainer);
    });
  }

  // ============= ACTIVITY FEED =============
  function renderActivityFeed() {
    const activityList = document.getElementById('activityList');
    const activityLog = JSON.parse(localStorage.getItem('activityLog') || '[]');

    if (activityLog.length === 0) {
      activityList.innerHTML = `
        <div class="activity-empty">
          <div style="font-size: 2rem; margin-bottom: 8px;">üìã</div>
          <p>No activity yet.<br>Start your first session!</p>
        </div>
      `;
      return;
    }

    activityList.innerHTML = '';

    // Show last 5 activities
    const recentActivities = activityLog.slice(-5).reverse();

    recentActivities.forEach(activity => {
      const item = document.createElement('div');
      item.className = 'activity-item';

      const date = new Date(activity.date);
      const timeAgo = getTimeAgo(date);

      item.innerHTML = `
        <div class="activity-icon">‚úì</div>
        <div class="activity-content">
          <div class="activity-title">${activity.habitName}</div>
          <div class="activity-time">${timeAgo} ‚Ä¢ 15 minutes</div>
        </div>
      `;

      activityList.appendChild(item);
    });
  }

  function getTimeAgo(date) {
    const now = new Date();
    const diffMs = now - date;
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMins / 60);
    const diffDays = Math.floor(diffHours / 24);

    if (diffMins < 60) return `${diffMins} min ago`;
    if (diffHours < 24) return `${diffHours}h ago`;
    if (diffDays === 1) return 'Yesterday';
    if (diffDays < 7) return `${diffDays} days ago`;
    return date.toLocaleDateString('en-US');
  }

  // ============= MOTIVATIONAL QUOTES =============
  const quotes = [
    { text: "Discipline is the bridge between goals and accomplishment.", author: "Jim Rohn" },
    { text: "A journey of a thousand miles begins with a single step.", author: "Lao Tzu" },
    { text: "Success is the sum of small efforts repeated day in and day out.", author: "Robert Collier" },
    { text: "We are what we repeatedly do. Excellence, then, is not an act but a habit.", author: "Aristotle" },
    { text: "Motivation gets you going, habit keeps you going.", author: "Jim Ryun" },
    { text: "Every day is a new opportunity to get better.", author: "Anonymous" },
    { text: "Small daily actions create big changes over time.", author: "Robin Sharma" },
    { text: "Consistency is the key to mastery.", author: "Bruce Lee" },
    { text: "Don't count the days, make the days count.", author: "Muhammad Ali" },
    { text: "The secret of getting ahead is getting started.", author: "Mark Twain" }
  ];

  function displayRandomQuote() {
    const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
    document.getElementById('quoteText').textContent = `"${randomQuote.text}"`;
    document.getElementById('quoteAuthor').textContent = `‚Äî ${randomQuote.author}`;
  }

  // ============= ACHIEVEMENTS =============
  const achievements = [
    { id: 'first_session', icon: 'üå±', title: 'First Step', desc: 'First session completed', unlockCondition: () => completed >= 1 },
    { id: 'streak_3', icon: 'üî•', title: 'On the way!', desc: '3 days in a row', unlockCondition: () => streak >= 3 },
    { id: 'streak_7', icon: '‚≠ê', title: 'One week!', desc: '7 days in a row', unlockCondition: () => streak >= 7 },
    { id: 'streak_15', icon: 'üíé', title: 'Gem', desc: '15 days in a row', unlockCondition: () => streak >= 15 },
    { id: 'streak_30', icon: 'üëë', title: 'Champion', desc: '30 days in a row', unlockCondition: () => streak >= 30 },
    { id: 'sessions_10', icon: 'üí™', title: 'Persistent', desc: '10 total sessions', unlockCondition: () => completed >= 10 },
    { id: 'sessions_50', icon: 'üöÄ', title: 'Determined', desc: '50 total sessions', unlockCondition: () => completed >= 50 },
    { id: 'hours_5', icon: '‚è∞', title: '5 hours', desc: '5 hours invested', unlockCondition: () => totalMinutes >= 300 },
    { id: 'two_habits', icon: 'üéØ', title: 'Two habits', desc: '2 active habits', unlockCondition: () => habits.length >= 2 },
  ];

  function renderAchievements() {
    const grid = document.getElementById('achievementsGrid');
    grid.innerHTML = '';

    achievements.forEach(achievement => {
      const isUnlocked = achievement.unlockCondition();
      
      const card = document.createElement('div');
      card.className = `achievement-card ${isUnlocked ? 'unlocked' : 'locked'}`;
      
      card.innerHTML = `
        <div class="achievement-icon">${achievement.icon}</div>
        <div class="achievement-title">${achievement.title}</div>
        <div class="achievement-desc">${achievement.desc}</div>
      `;

      grid.appendChild(card);
    });
  }

  // ============= UPDATE ALL SECTIONS =============
  function updateAllSections() {
    renderProgressChart();
    renderActivityFeed();
    renderAchievements();
  }

  // Initial render
  displayRandomQuote();
  updateAllSections();

  // Override completeSession to update activity log
  const originalCompleteSession = completeSession;
  completeSession = function() {
    // Log the activity
    const activityLog = JSON.parse(localStorage.getItem('activityLog') || '[]');
    activityLog.push({
      date: new Date().toISOString(),
      habitName: habits[selectedIndex]?.name || 'Habit',
      duration: 15
    });
    localStorage.setItem('activityLog', JSON.stringify(activityLog));

    // Call original function
    originalCompleteSession();

    // Update sections
    updateAllSections();
  };
})();
</script>

<!-- Bottom navigation (mobile) -->
<style>
  .bottom-nav{position:fixed;left:0;right:0;bottom:0;display:none;background:rgba(255,255,255,0.98);backdrop-filter:blur(8px);border-top:1px solid rgba(43,0,59,0.06);box-shadow:0 -6px 24px rgba(0,0,0,0.08);z-index:1005;padding:env(safe-area-inset-bottom,12px) 12px 12px}
  .bottom-nav .nav-row{display:flex;gap:6px;justify-content:space-around;align-items:center;max-width:900px;margin:0 auto}
  .bottom-nav .nav-item{text-decoration:none;color:var(--gray-700);display:flex;flex-direction:column;align-items:center;font-size:0.8rem;gap:4px;padding:8px 6px;border-radius:10px;transition:background .12s,transform .12s}
  .bottom-nav .nav-item .nav-icon{font-size:1.25rem;line-height:1}
  .bottom-nav .nav-item.active,.bottom-nav .nav-item:focus,.bottom-nav .nav-item:hover{color:var(--violet-600);transform:translateY(-4px)}
  @media (max-width:900px){.bottom-nav{display:block}.hamburger{display:none}main{padding-bottom:calc(84px + env(safe-area-inset-bottom))}}
</style>
<nav class="bottom-nav" id="bottomNav" role="navigation" aria-label="Bottom navigation">
  <div class="nav-row">
    <a href="../dashboard.html" class="nav-item" data-key="dashboard" aria-label="Dashboard"><div class="nav-icon"><i class="fi fi-rr-dashboard"></i></div><div class="nav-label">Dashboard</div></a>
    <a href="../profile.html" class="nav-item" data-key="profile" aria-label="Profile"><div class="nav-icon" id="bottomProfileIcon"></div><div class="nav-label">Profile</div></a>
    <a href="../commitmentpage.html" class="nav-item" data-key="commitments" aria-label="Commitments"><div class="nav-icon"><i class="fi fi-rr-diploma"></i></div><div class="nav-label">Commitments</div></a>
    <a href="../statistics.html" class="nav-item" data-key="statistics" aria-label="Statistics"><div class="nav-icon"><i class="fi fi-rr-chart-pie"></i></div><div class="nav-label">Stats</div></a>
    <a href="../parametes.html" class="nav-item" data-key="settings" aria-label="Settings"><div class="nav-icon"><i class="fi fi-rr-settings"></i></div><div class="nav-label">Settings</div></a>
  </div>
</nav>
<script>
  (function(){
    const path=window.location.pathname||'';
    const map={'/pages/dashboard.html':'dashboard','/pages/profile.html':'profile','/pages/commitmentpage.html':'commitments','/pages/statistics.html':'statistics','/pages/parametes.html':'settings'};
    const key=map[path]||Object.keys(map).find(k=>path.endsWith(k.split('/').pop()))||'dashboard';
    document.querySelectorAll('.bottom-nav .nav-item').forEach(item=>{if(item.dataset.key===key)item.classList.add('active')});
    try{const h=document.getElementById('profileIcon'),b=document.getElementById('bottomProfileIcon');if(h&&b){b.innerHTML=h.innerHTML}}catch(e){}
  })();
</script>
</body>
</html>